<!DOCTYPE html>
<html>
<head>
  <style>
    * { box-sizing: border-box; }
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: rgba(0,0,0,0.1); cursor: crosshair; }
    
    #selection {
      border: 2px solid #ff0000;
      background: rgba(255, 0, 0, 0.1);
      position: absolute; display: none; z-index: 99;
    }
    #msg {
      position: absolute; top: 10px; width: 100%; text-align: center; pointer-events: none; z-index: 100;
    }
    span { background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 5px; font-family: sans-serif; font-size: 14px; }
  </style>
</head>
<body>
  <div id="msg"><span>Drag to select area (Esc to cancel)</span></div>
  <div id="selection"></div>

  <script>
    const { ipcRenderer } = require('electron');
    const sel = document.getElementById('selection');
    let startX, startY, dragging = false;

    window.addEventListener('mousedown', e => {
      if (e.button !== 0) return;
      startX = e.clientX; startY = e.clientY; dragging = true;
      sel.style.display = 'block';
      sel.style.width = '0px'; sel.style.height = '0px';
      sel.style.left = startX + 'px'; sel.style.top = startY + 'px';
    });

    window.addEventListener('mousemove', e => {
      if (!dragging) return;
      const w = Math.abs(e.clientX - startX);
      const h = Math.abs(e.clientY - startY);
      sel.style.left = Math.min(e.clientX, startX) + 'px';
      sel.style.top = Math.min(e.clientY, startY) + 'px';
      sel.style.width = w + 'px'; sel.style.height = h + 'px';
    });

    window.addEventListener('mouseup', () => {
      if (!dragging) return;
      dragging = false;
      const rect = sel.getBoundingClientRect();
      if (rect.width > 5 && rect.height > 5) {
        // Send window size to ensure correct scaling logic
        ipcRenderer.send('region-selected', { 
          bounds: { x: rect.x, y: rect.y, width: rect.width, height: rect.height },
          screenWidth: window.innerWidth,
          screenHeight: window.innerHeight
        });
      } else {
        ipcRenderer.send('region-selected', null);
      }
    });

    window.addEventListener('keydown', e => { 
      if (e.key === 'Escape') ipcRenderer.send('region-selected', null); 
    });
  </script>
</body>
</html>